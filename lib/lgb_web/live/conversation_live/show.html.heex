<.page_align no_padding={true}>
  <.card class="flex flex-col h-screen h-full">
    <!-- Chat Header -->
    <.card class="flex justify-between items-center">
      <div class="flex items-center align-middle gap-2">
        <img
          src={Lgb.Profiles.ProfilePicture.get_picture_url(@other_profile.first_picture)}
          alt="Avatar"
          class="w-12 h-12 sm:w-16 sm:h-16 rounded-full object-cover"
        />
        <span class="font-semibold text-lg">
          <.link navigate={~p"/profiles/#{@other_profile.id}"}>
            <.name_with_online_activity profile={@other_profile} primary={false} />
          </.link>
        </span>
      </div>
      <span class="text-xs text-gray-400 font-light">
        <%= cond do %>
          <% LgbWeb.UserPresence.within_minutes?(@other_profile.user.last_login_at, 60) -> %>
            {LgbWeb.UserPresence.format_hours_ago(@other_profile.user.last_login_at)}
          <% LgbWeb.UserPresence.within_hours?(@other_profile.user.last_login_at, 24) -> %>
            Last active yesterday
          <% true -> %>
            Last active {Calendar.strftime(@other_profile.user.last_login_at, "%b %d")}
        <% end %>
      </span>
    </.card>
    <div
      id="conversation-messages"
      phx-update="stream"
      phx-viewport-top="load_more"
      class="flex-1 h-[800px] overflow-y-auto"
      phx-hook="ScrollBottom"
    >
      <div :for={{dom_id, message} <- @streams.all_messages} id={dom_id}>
        <div class={"flex " <> if message.profile.id == @current_user.id, do: "justify-end", else: "justify-start"}>
          <div class={"text-sm p-3 mx-1 my-1 rounded-3xl max-w-[70%] " <> if message.profile.id == @current_user.id, do: "bg-green-100", else: "bg-purple-100"}>
            {message.content} - {Calendar.strftime(message.inserted_at, "%I:%M %p")}
          </div>
        </div>
      </div>
    </div>
    <.simple_form for={@form} phx-change="validate" phx-submit="send">
      <div class="flex w-full space-x-2 p-4 bg-white rounded-b-lg shadow-sm">
        <.input
          id="one-one-message"
          class="p-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          field={@form[:content]}
          name="content"
          placeholder="Type a message..."
        />
        <.button class="px-4 py-2 bg-colorPrimary text-white rounded-lg hover:bg-colorPrimary focus:outline-none focus:ring-2 focus:ring-blue-500">
          Send
        </.button>
      </div>
    </.simple_form>
  </.card>
</.page_align>
